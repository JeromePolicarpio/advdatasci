<!DOCTYPE html>
<html>
  <head>
    <title>Tidy text and sentiment analysis</title>
    <meta charset="utf-8">
    <meta name="author" content="www.jtleek.com/advdatasci" />
    <link href="libs/remark-css/example.css" rel="stylesheet" />
    <link rel="stylesheet" href="../additional.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tidy text and sentiment analysis
## JHU Data Science
### www.jtleek.com/advdatasci

---

class: inverse, middle, center




# What are the data we see?

---
background-image: url(../imgs/tidytext/trump.png)
background-size: 60% 
background-position: bottom

# This is data

---
background-image: url(../imgs/tidytext/janeaustin.png)
background-size: 80% 
background-position: bottom

# This too


---
background-image: url(../imgs/tidytext/tidytext.png)
background-size: 80% 
background-position: center

.footnote[http://joss.theoj.org/papers/89fd1099620268fe0342ffdcdf66776f]

---
class: inverse

## Look at some text


```r
suppressPackageStartupMessages({library(dplyr)})
library(tidytext)
txt = c("These are words", "so are these", "this is running on")
sentence = c(1, 2, 3)
dat = tibble(txt, sentence)
unnest_tokens(dat,tok,txt)
```

```
# A tibble: 10 x 2
   sentence     tok
      &lt;dbl&gt;   &lt;chr&gt;
 1        1   these
 2        1     are
 3        1   words
 4        2      so
 5        2     are
 6        2   these
 7        3    this
 8        3      is
 9        3 running
10        3      on
```

---
class: inverse

## What is tokenization? 

&lt;div style='font-size:30pt'&gt;

&gt; "The process of segmenting running text into words and sentences."

- Split on white space/punctuation
- Make lower case 
- Keep contractions together
- Maybe put quoted words together (not in unnest_tokens)

&lt;/p&gt;

---
class: inverse

## One line per row


```r
library(janeaustenr)
original_books &lt;- austen_books() %&gt;%
  group_by(book) %&gt;%
  mutate(linenumber = row_number()) %&gt;%
  ungroup()
head(original_books)
```

```
# A tibble: 6 x 3
                   text                book linenumber
                  &lt;chr&gt;              &lt;fctr&gt;      &lt;int&gt;
1 SENSE AND SENSIBILITY Sense &amp; Sensibility          1
2                       Sense &amp; Sensibility          2
3        by Jane Austen Sense &amp; Sensibility          3
4                       Sense &amp; Sensibility          4
5                (1811) Sense &amp; Sensibility          5
6                       Sense &amp; Sensibility          6
```

---
class: inverse

## One token per row


```r
tidy_books &lt;- original_books %&gt;% unnest_tokens(word, text)
head(tidy_books)
```

```
# A tibble: 6 x 3
                 book linenumber        word
               &lt;fctr&gt;      &lt;int&gt;       &lt;chr&gt;
1 Sense &amp; Sensibility          1       sense
2 Sense &amp; Sensibility          1         and
3 Sense &amp; Sensibility          1 sensibility
4 Sense &amp; Sensibility          3          by
5 Sense &amp; Sensibility          3        jane
6 Sense &amp; Sensibility          3      austen
```


---
class: inverse
background-image: url(../imgs/tidytext/wordcloud.png)
background-size: 80% 
background-position: center

# Stop words/words to filter

.footnote[http://xpo6.com/list-of-english-stop-words/]

---
class: inverse

## Stop words/words to filter


```r
tidy_books %&gt;% 
  group_by(word) %&gt;% 
  tally() %&gt;% 
  arrange(desc(n))
```

```
# A tibble: 14,520 x 2
    word     n
   &lt;chr&gt; &lt;int&gt;
 1   the 26351
 2    to 24044
 3   and 22515
 4    of 21178
 5     a 13408
 6   her 13055
 7     i 12006
 8    in 11217
 9   was 11204
10    it 10234
# ... with 14,510 more rows
```


---
class: inverse

## Stemming


```r
library(SnowballC)
wordStem(c("running","fasted"))
```

```
[1] "run"  "fast"
```

---
class: inverse

## Filtering with joins


```r
head(stop_words)
```

```
# A tibble: 6 x 2
       word lexicon
      &lt;chr&gt;   &lt;chr&gt;
1         a   SMART
2       a's   SMART
3      able   SMART
4     about   SMART
5     above   SMART
6 according   SMART
```

```r
tidy_books = tidy_books %&gt;% anti_join(stop_words, by = "word")
head(tidy_books)
```

```
# A tibble: 6 x 3
                 book linenumber        word
               &lt;fctr&gt;      &lt;int&gt;       &lt;chr&gt;
1 Sense &amp; Sensibility          1       sense
2 Sense &amp; Sensibility          1 sensibility
3 Sense &amp; Sensibility          3        jane
4 Sense &amp; Sensibility          3      austen
5 Sense &amp; Sensibility          5        1811
6 Sense &amp; Sensibility         10     chapter
```

---
class: inverse

## Example classification


.pull-left[
![](../imgs/tidytext/janeaustin.png)
]
&lt;p style="  display: inline-block; font-size: 20pt; padding: 15% 0;"&gt; vs. &lt;/p&gt;
.pull-right[
![](../imgs/tidytext/ap.png)
]


---
class: inverse

## Example classification


```r
library(tm); 
```

```
Loading required package: NLP
```

```r
data("AssociatedPress", package = "topicmodels")
AssociatedPress
```

```
&lt;&lt;DocumentTermMatrix (documents: 2246, terms: 10473)&gt;&gt;
Non-/sparse entries: 302031/23220327
Sparsity           : 99%
Maximal term length: 18
Weighting          : term frequency (tf)
```

```r
class(AssociatedPress)
```

```
[1] "DocumentTermMatrix"    "simple_triplet_matrix"
```

---
class: inverse

## Compare frequencies


```r
comparison &lt;- tidy(AssociatedPress) %&gt;%
    count(word = term) %&gt;%
    rename(AP = n) %&gt;%
    inner_join(count(tidy_books, word)) %&gt;%
    rename(Austen = n) %&gt;%
    mutate(AP = AP / sum(AP),
           Austen = Austen / sum(Austen),
           diff=AP - Austen) %&gt;% 
  arrange(diff)
```

```
Joining, by = "word"
```

```r
head(comparison)
```

```
# A tibble: 6 x 4
       word           AP      Austen         diff
      &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1      lady 0.0001019001 0.005795765 -0.005693865
2      time 0.0038242522 0.009484624 -0.005660372
3       sir 0.0001198825 0.005717731 -0.005597849
4    sister 0.0002157885 0.005157309 -0.004941520
5 elizabeth 0.0001618414 0.004873550 -0.004711709
6    friend 0.0002877180 0.004206718 -0.003919000
```



---
class: inverse

## Bag of words


```r
tidy_freq = tidy_books %&gt;% 
  group_by(book, word) %&gt;%
  summarize(count=n()) %&gt;% 
  ungroup()
head(tidy_freq)
```

```
# A tibble: 6 x 3
                 book  word count
               &lt;fctr&gt; &lt;chr&gt; &lt;int&gt;
1 Sense &amp; Sensibility     1     2
2 Sense &amp; Sensibility    10     1
3 Sense &amp; Sensibility    11     1
4 Sense &amp; Sensibility    12     1
5 Sense &amp; Sensibility    13     1
6 Sense &amp; Sensibility    14     1
```

---
class: inverse

## Bag of words


```r
nonum = tidy_freq %&gt;% 
  filter(is.na(as.numeric(word)))
```

```
Warning in evalq(is.na(as.numeric(word)), &lt;environment&gt;): NAs introduced by
coercion
```

```r
head(nonum)
```

```
# A tibble: 6 x 3
                 book      word count
               &lt;fctr&gt;     &lt;chr&gt; &lt;int&gt;
1 Sense &amp; Sensibility     7000l     1
2 Sense &amp; Sensibility abandoned     1
3 Sense &amp; Sensibility abatement     1
4 Sense &amp; Sensibility abbeyland     1
5 Sense &amp; Sensibility     abhor     1
6 Sense &amp; Sensibility  abhorred     2
```

---
class: inverse

## Combine "bags"

```r
tidy_ap = tidy(AssociatedPress) %&gt;% 
  rename(book = document, 
         word = term, 
         count = count)
dat = rbind(tidy_ap, tidy_freq) 
head(dat)
```

```
# A tibble: 6 x 3
   book      word count
  &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
1     1    adding     1
2     1     adult     2
3     1       ago     1
4     1   alcohol     1
5     1 allegedly     1
6     1     allen     1
```


---
class: inverse

## Term-document matrices


```r
dtm = dat %&gt;% cast_dtm(book,word, count)
inspect(dtm[1:6,1:10])
```

```
&lt;&lt;DocumentTermMatrix (documents: 6, terms: 10)&gt;&gt;
Non-/sparse entries: 15/45
Sparsity           : 75%
Maximal term length: 10
Weighting          : term frequency (tf)
Sample             :
    Terms
Docs adding adult ago alcohol allegedly allen apparently appeared arrested
   1      1     2   1       1         1     1          2        1        1
   2      0     0   0       0         0     0          0        1        0
   3      0     0   1       0         0     0          0        1        0
   4      0     0   3       0         0     0          0        0        0
   5      0     0   0       0         0     0          0        0        0
   6      0     0   2       0         0     0          0        0        0
    Terms
Docs assault
   1       1
   2       0
   3       0
   4       0
   5       0
   6       0
```

```r
dtm = as.matrix(dtm)
dtm = dtm/rowSums(dtm)
```


---
class: inverse

## Classify


```r
cor1 = cor(dtm[1,], t(dtm))[1,]; print(cor1); plot(cor1)
```

```
            1             2             3             4             5 
 1.000000e+00  1.817799e-02  1.808524e-01  4.745425e-02  3.157564e-02 
            6             7             8             9            10 
 2.169911e-02  2.122569e-02 -3.227469e-03 -1.480073e-03  6.527424e-02 
           11            12            13            14            15 
 2.194200e-02  5.059193e-02  6.249228e-02 -2.770179e-03  1.328884e-02 
           16            17            18            19            20 
 4.279592e-02  4.955178e-02  4.569414e-02  1.794129e-02  1.857823e-02 
           21            22            23            24            25 
 1.336724e-01 -1.495105e-03 -1.480073e-03  3.378975e-02  2.046964e-02 
           26            27            28            29            30 
 1.912659e-02  9.800995e-03  5.820638e-02  8.892860e-02  5.046103e-02 
           31            32            33            34            35 
 2.978128e-02  7.671927e-02  1.526370e-02  4.030380e-02  6.703577e-02 
           36            37            38            39            40 
 2.857149e-02  3.663861e-02  1.253281e-02  1.605410e-02  1.315626e-02 
           41            42            43            44            45 
 2.420212e-02  9.817124e-03  1.285805e-01  3.096027e-02  4.232919e-02 
           46            47            48            49            50 
 1.674042e-02 -5.980857e-04  1.102789e-02  8.812355e-02  1.983595e-02 
           51            52            53            54            55 
 3.218451e-02  6.507945e-03  1.641751e-02  5.752979e-02  2.825458e-02 
           56            57            58            59            60 
 1.032770e-02  2.839371e-02  3.012761e-02  7.424077e-02 -1.614946e-03 
           61            62            63            64            65 
 8.433389e-03  2.970449e-03  1.984615e-02  7.652867e-02  3.483058e-03 
           66            67            68            69            70 
 2.702583e-02  8.634774e-03  2.596415e-02  3.495307e-03  7.160648e-02 
           71            72            73            74            75 
 4.357453e-02  1.858550e-01  6.094667e-03  5.785831e-02  2.019551e-02 
           76            77            78            79            80 
 5.067057e-02  2.917931e-02  3.984250e-02  2.787071e-02  7.341795e-02 
           81            82            83            84            85 
 5.488386e-02  3.591602e-02  8.133528e-02  8.596848e-02  1.334794e-02 
           86            87            88            89            90 
 3.797267e-02  1.605263e-02  3.527023e-02  5.896791e-03  8.748253e-02 
           91            92            93            94            95 
 1.357196e-01  3.345655e-02  7.310597e-03  1.283642e-02  1.781384e-02 
           96            97            98            99           100 
 2.709658e-02  2.660877e-02  3.138561e-02  1.505361e-02  5.383000e-02 
          101           102           103           104           105 
 4.821246e-02  5.389834e-02  4.075852e-02  5.732730e-02  4.161361e-02 
          106           107           108           109           110 
 7.600615e-03  2.588651e-02  2.716307e-02  2.731600e-02  8.725627e-02 
          111           112           113           114           115 
 1.655211e-02  7.867760e-02  5.942056e-03  3.807272e-03  1.848960e-02 
          116           117           118           119           120 
 6.299904e-02  1.280701e-02  2.691823e-02  1.385943e-02  1.038210e-02 
          121           122           123           124           125 
 9.291285e-04  4.370529e-03  7.515436e-03  3.803341e-02  1.443386e-02 
          126           127           128           129           130 
-1.544332e-03  3.834584e-02  1.432635e-02  1.571223e-02  4.920125e-02 
          131           132           133           134           135 
 6.844815e-02  1.105308e-02  1.647873e-02  1.585348e-02  2.156491e-02 
          136           137           138           139           140 
 1.388586e-02  8.043104e-02  1.208400e-01  6.791614e-02  1.596103e-02 
          141           142           143           144           145 
 2.246520e-01  1.914766e-02  4.047139e-02  1.880085e-02  8.995789e-03 
          146           147           148           149           150 
 8.086832e-02  2.690235e-02  4.317751e-02  5.492220e-03  8.685181e-02 
          151           152           153           154           155 
 2.257391e-02  2.467980e-01  8.710744e-02  2.551234e-02  9.825177e-03 
          156           157           158           159           160 
 2.134396e-02  4.326319e-02  1.341381e-02  2.162581e-01  5.914995e-02 
          161           162           163           164           165 
 4.269547e-02  6.975066e-03  1.857785e-01  1.792096e-02 -2.624877e-03 
          166           167           168           169           170 
 1.305799e-02  7.349196e-02  6.299963e-02  4.452263e-02  1.221773e-01 
          171           172           173           174           175 
 2.323740e-02  6.769515e-03  6.200092e-02  1.402781e-02  1.496199e-02 
          176           177           178           179           180 
 1.161199e-02  6.721500e-02  1.450790e-02  2.549607e-02  1.217693e-01 
          181           182           183           184           185 
 1.508779e-02  6.185508e-02  3.139616e-02  2.793697e-02  4.805101e-02 
          186           187           188           189           190 
 3.215136e-02 -3.143821e-03 -8.160727e-05  1.799359e-02  4.960074e-02 
          191           192           193           194           195 
 1.085005e-02  3.512668e-02  1.898733e-02  9.277475e-03  2.748716e-02 
          196           197           198           199           200 
 4.326592e-02  1.119264e-01  1.775462e-02  2.374287e-02  3.065923e-02 
          201           202           203           204           205 
 7.654852e-02  3.118385e-02  1.371053e-02  1.852636e-01  1.428935e-02 
          206           207           208           209           210 
 2.270833e-02  5.641328e-02  1.876578e-02  1.639330e-01  2.391196e-02 
          211           212           213           214           215 
 4.537071e-02  1.341448e-02  6.510429e-02  3.215691e-02  4.782793e-02 
          216           217           218           219           220 
 7.222219e-02  2.151006e-02  2.422992e-02  2.757182e-02  7.081173e-02 
          221           222           223           224           225 
 2.791982e-02  8.350412e-03  7.612663e-03  1.810803e-02  4.244032e-02 
          226           227           228           229           230 
 5.758180e-02  2.348142e-02  3.951268e-02  7.355113e-03  1.164387e-01 
          231           232           233           234           235 
 3.800329e-02  6.852532e-02  3.027442e-02  3.753046e-02  2.776062e-02 
          236           237           238           239           240 
 4.293839e-02  6.424814e-03  2.110074e-02  1.493158e-01  4.598968e-03 
          241           242           243           244           245 
 1.072943e-01  9.014314e-03  1.594324e-02  2.326839e-02  4.230413e-02 
          246           247           248           249           250 
 1.651435e-02 -1.250827e-03  1.749422e-01  7.277749e-03  2.888365e-02 
          251           252           253           254           255 
 4.676050e-03  5.024276e-02  3.599665e-02  9.012978e-02  2.301035e-02 
          256           257           258           259           260 
 3.332668e-02  1.690838e-01  1.246729e-02  8.819467e-02  2.401596e-02 
          261           262           263           264           265 
 1.961320e-02  3.661091e-02  1.626646e-02  7.669643e-03  1.034845e-01 
          266           267           268           269           270 
 7.676327e-03  2.032497e-01  6.340087e-02  1.920815e-02  1.389657e-02 
          271           272           273           274           275 
 3.051860e-02  2.360775e-02  4.387653e-03  2.659802e-02  2.194200e-02 
          276           277           278           279           280 
 3.872811e-01  3.914838e-02  6.207636e-02  3.993887e-02  7.798697e-02 
          281           282           283           284           285 
 9.991943e-02  4.306468e-02  8.299853e-02  4.311099e-02  9.771754e-03 
          286           287           288           289           290 
 3.282197e-02  2.524716e-02  2.358542e-02  1.320247e-02  1.496860e-01 
          291           292           293           294           295 
 4.490738e-02  4.872877e-02  1.244451e-02  1.185786e-01  9.573480e-03 
          296           297           298           299           300 
 3.694495e-02  1.127277e-02  2.559570e-02  2.262887e-02  1.921598e-02 
          301           302           303           304           305 
 2.621291e-02  1.872198e-02  5.054666e-02  2.045240e-01  1.566450e-02 
          306           307           308           309           310 
 1.730591e-02  3.413464e-02  1.088903e-02  2.403813e-02  9.209672e-03 
          311           312           313           314           315 
 2.224987e-02  4.854254e-02  2.728302e-02  5.504546e-02  3.981837e-02 
          316           317           318           319           320 
 2.661290e-02  2.231931e-02  1.974602e-02  2.719714e-02  1.254548e-01 
          321           322           323           324           325 
 4.841154e-02  4.161265e-02  4.030680e-02  1.535943e-01  6.926560e-02 
          326           327           328           329           330 
-1.250827e-03  1.047447e-01  2.983313e-02  4.922388e-02  1.882918e-02 
          331           332           333           334           335 
 3.306844e-02  7.766829e-02  6.558882e-02  6.909214e-02  3.217544e-02 
          336           337           338           339           340 
 2.320352e-02  1.158177e-01  1.009697e-03  1.772560e-02  6.258373e-02 
          341           342           343           344           345 
 4.299727e-02  4.420756e-02  2.552226e-02  7.941721e-02  2.974021e-02 
          346           347           348           349           350 
 3.938193e-02  3.206959e-02  5.191634e-02  1.821570e-02  2.236474e-02 
          351           352           353           354           355 
 3.575784e-02  3.016023e-02  2.602932e-02  1.204251e-01  4.515024e-02 
          356           357           358           359           360 
 1.998790e-01  2.642832e-02  1.610569e-01  2.529475e-01  2.932720e-02 
          361           362           363           364           365 
 1.131486e-02  3.001645e-02  5.623300e-03  1.080703e-01  4.495544e-02 
          366           367           368           369           370 
 4.970218e-02  1.322598e-02  1.401598e-02  5.355854e-02  1.059392e-02 
          371           372           373           374           375 
 4.533788e-02  5.560859e-02  3.128942e-03  5.128767e-02  1.078654e-02 
          376           377           378           379           380 
 2.006214e-02  1.523515e-01  1.150019e-01  8.692117e-02  6.292552e-02 
          381           382           383           384           385 
-7.910332e-04  7.867895e-02  1.773171e-02  1.539618e-02  3.775963e-02 
          386           387           388           389           390 
 3.425135e-03  6.828502e-03  2.201863e-02  2.686727e-02  3.768402e-02 
          391           392           393           394           395 
 6.420480e-02  2.203401e-02  5.364650e-02  5.300321e-02  2.636123e-02 
          396           397           398           399           400 
 6.856462e-02  2.110566e-02  5.894487e-02  4.019439e-02  2.070237e-02 
          401           402           403           404           405 
 1.276374e-02  1.463560e-02  7.360925e-02  8.310364e-03  6.393303e-03 
          406           407           408           409           410 
 2.576278e-02  3.308800e-02  2.881575e-02  4.047594e-02  1.180426e-01 
          411           412           413           414           415 
 3.213752e-02  9.026025e-03  1.652113e-02  9.800425e-03  2.229212e-02 
          416           417           418           419           420 
 3.976842e-02  3.510623e-02  1.724633e-02  4.196367e-02  1.320513e-02 
          421           422           423           424           425 
 2.806855e-02  7.813465e-02  1.587261e-02  7.532246e-02  9.001060e-03 
          426           427           428           429           430 
 3.960544e-02  1.558405e-02  2.705888e-02  2.447982e-02  2.381540e-02 
          431           432           433           434           435 
 6.395823e-03  2.143483e-02  1.282349e-02  1.306968e-02  2.589351e-02 
          436           437           438           439           440 
 1.491410e-02  6.310051e-02  1.329148e-01  2.067409e-02  3.791445e-02 
          441           442           443           444           445 
 6.328362e-02  1.955422e-02  5.961751e-02 -1.480073e-03  4.441431e-02 
          446           447           448           449           450 
 3.705115e-02  2.419439e-02  1.886508e-02  1.536942e-02  6.026895e-03 
          451           452           453           454           455 
 9.994111e-03  3.206762e-02  1.216567e-01  2.854678e-02  8.673585e-02 
          456           457           458           459           460 
 2.999174e-02  1.238678e-02  3.628205e-02  1.093465e-02  2.066236e-02 
          461           462           463           464           465 
 1.529475e-02  7.072903e-02  1.936523e-02  3.956048e-02  6.807101e-03 
          466           467           468           469           470 
 2.098309e-02  1.417232e-02  9.723642e-03  4.060580e-02  2.634647e-02 
          471           472           473           474           475 
 4.147149e-02  6.177440e-02  1.051988e-02  8.651622e-02  1.120054e-02 
          476           477           478           479           480 
 9.386668e-03  5.595779e-02  8.787001e-03  3.139143e-02  4.206099e-02 
          481           482           483           484           485 
 2.410538e-02  1.923605e-02  4.160291e-04  4.615951e-02  1.869374e-03 
          486           487           488           489           490 
 8.115505e-03  2.247512e-02  1.374364e-02  1.579394e-02  9.098495e-02 
          491           492           493           494           495 
 2.187188e-02  1.512253e-02  2.613366e-02  1.998730e-02  3.693924e-02 
          496           497           498           499           500 
 5.135796e-02  1.388109e-02  2.117575e-02  1.635669e-02  5.300278e-02 
          501           502           503           504           505 
 2.405801e-02  5.858412e-02  7.304985e-02  2.526399e-02  2.231150e-02 
          506           507           508           509           510 
 3.438980e-02  3.272946e-02  3.380001e-02  3.624691e-02  2.593701e-02 
          511           512           513           514           515 
 1.319725e-02  1.007433e-01  1.299446e-02  2.911412e-02  1.816767e-02 
          516           517           518           519           520 
 2.608922e-02  2.069961e-02  1.031327e-02  2.747352e-02  1.226808e-02 
          521           522           523           524           525 
 6.973084e-03  3.929784e-02  1.913893e-01  1.262855e-01  1.915609e-02 
          526           527           528           529           530 
 6.989453e-02  3.053852e-02  7.410098e-02  1.322540e-02  4.616904e-03 
          531           532           533           534           535 
 4.457959e-02  3.056242e-02  9.709430e-02  9.044239e-02  5.900884e-02 
          536           537           538           539           540 
-2.350170e-03  1.595305e-02  1.529373e-02  8.004582e-03  2.400219e-02 
          541           542           543           544           545 
 3.888842e-02  2.416952e-02  1.218238e-01  1.841674e-02  1.538164e-02 
          546           547           548           549           550 
 3.097798e-02  2.314093e-02  1.023846e-02  1.448569e-02 -3.072017e-03 
          551           552           553           554           555 
 2.553810e-02  3.875010e-03  6.156689e-02  4.675882e-02  1.528851e-02 
          556           557           558           559           560 
 2.627103e-02  1.645019e-01 -2.893519e-03  1.342101e-02  9.351320e-02 
          561           562           563           564           565 
 1.838483e-02  1.717377e-01  3.466825e-02  1.394875e-01  1.175365e-01 
          566           567           568           569           570 
 4.213866e-02  9.417841e-02  1.089124e-01  3.910944e-02  1.614731e-01 
          571           572           573           574           575 
 3.741335e-02  1.029698e-01  2.533724e-01  7.716357e-02  4.052937e-02 
          576           577           578           579           580 
 2.898757e-02  2.120962e-02  1.416813e-01  1.910467e-03  3.684578e-02 
          581           582           583           584           585 
 9.255974e-02  3.904579e-02  3.421213e-02  1.217961e-01  2.893613e-02 
          586           587           588           589           590 
 8.075261e-02  7.990268e-02  8.731487e-03 -4.054125e-04  4.574453e-02 
          591           592           593           594           595 
 2.652588e-02  9.202969e-03  3.129319e-02  3.657326e-02  2.096872e-02 
          596           597           598           599           600 
 3.529904e-02  4.477545e-02  1.362831e-02  6.778766e-02  2.738978e-03 
          601           602           603           604           605 
 1.344544e-01  4.380553e-02  1.059714e-01  2.914817e-02  4.438673e-02 
          606           607           608           609           610 
 2.713552e-03  4.486342e-02  1.041880e-01  2.789649e-02  2.305735e-02 
          611           612           613           614           615 
 2.361609e-02  1.533805e-01  4.018349e-02  1.682908e-02  2.042133e-01 
          616           617           618           619           620 
 3.463589e-02  1.654549e-02  3.992819e-02  1.810584e-02  1.346348e-01 
          621           622           623           624           625 
 2.839574e-02  3.315968e-02  4.955302e-02  2.182227e-01  4.874623e-02 
          626           627           628           629           630 
 6.907070e-02 -1.855556e-03  3.757457e-02  3.145109e-02  7.403791e-02 
          631           632           633           634           635 
 3.324390e-02  3.070238e-02  2.518819e-02  2.441437e-02  9.006865e-03 
          636           637           638           639           640 
 9.826395e-03  5.314790e-02  2.912058e-02  5.060592e-02  8.429719e-02 
          641           642           643           644           645 
 3.759481e-03  7.199368e-02  1.901064e-02  4.001755e-02  5.149451e-02 
          646           647           648           649           650 
 6.390220e-03  3.776356e-02  1.881633e-02  4.047411e-02 -8.166367e-04 
          651           652           653           654           655 
 6.377839e-03  1.746786e-01  4.827765e-02  5.657818e-02  4.536289e-02 
          656           657           658           659           660 
 1.656110e-01  1.382285e-02  3.758545e-02  1.118350e-02  2.750912e-02 
          661           662           663           664           665 
 1.156234e-02  2.167738e-01  2.348314e-02  7.528297e-03  1.027156e-01 
          666           667           668           669           670 
 4.018389e-02  3.701092e-02  2.432356e-02  1.091272e-01  4.283260e-02 
          671           672           673           674           675 
 4.209704e-02  8.383442e-02 -1.268026e-03  3.356185e-02  2.066219e-02 
          676           677           678           679           680 
 4.173972e-02  1.741336e-02  3.649111e-02  1.626742e-02  9.492515e-02 
          681           682           683           684           685 
 5.910674e-02  2.671427e-02  3.235751e-02  1.177892e-02  1.127968e-02 
          686           687           688           689           690 
 2.345340e-02  9.382530e-03  8.249490e-02  2.297796e-02  3.023495e-02 
          691           692           693           694           695 
 2.823997e-02  2.102272e-05  3.286501e-02  7.833277e-03  2.280656e-02 
          696           697           698           699           700 
 1.188815e-02  2.068483e-02  4.554822e-02 -1.614946e-03  1.643671e-02 
          701           702           703           704           705 
 5.295238e-02  2.706498e-02  4.766255e-03  2.534590e-02  8.276592e-02 
          706           707           708           709           710 
 2.163884e-02  9.144886e-02  1.902635e-02 -7.910332e-04  2.635642e-02 
          711           712           713           714           715 
 6.407195e-02 -1.250827e-03  4.610611e-02  2.063545e-02  2.975965e-02 
          716           717           718           719           720 
 1.416790e-02  1.428598e-02  4.699732e-02 -1.769159e-03  3.614813e-03 
          721           722           723           724           725 
 7.883049e-02  1.460006e-02  9.438710e-02  4.604229e-02  3.371311e-02 
          726           727           728           729           730 
 8.732714e-02  3.361721e-02  6.425640e-03  2.126230e-02  1.877602e-02 
          731           732           733           734           735 
 1.735574e-01  2.610154e-02  3.336663e-02  5.875435e-02  1.835957e-02 
          736           737           738           739           740 
 1.840527e-02  1.095681e-01  2.115410e-02  2.354409e-02  9.486136e-03 
          741           742           743           744           745 
 1.146278e-02  6.802891e-02  2.536432e-02  2.598607e-02  1.726431e-02 
          746           747           748           749           750 
 2.427344e-02  4.174027e-02  2.744773e-02  3.641078e-02  2.394056e-02 
          751           752           753           754           755 
 6.437856e-02  6.298154e-02  1.830878e-02  4.995336e-02  2.054402e-01 
          756           757           758           759           760 
 3.642046e-02  1.181150e-02  9.548512e-03  3.827136e-02  8.517736e-02 
          761           762           763           764           765 
 7.951812e-02  1.160856e-02  5.267797e-03  8.343207e-02 -3.593091e-03 
          766           767           768           769           770 
 1.169502e-01  2.656497e-03  9.858567e-03  3.049137e-02  7.676361e-02 
          771           772           773           774           775 
 1.057902e-01  1.092803e-01  4.017074e-02  4.657776e-02  1.372028e-02 
          776           777           778           779           780 
 6.797456e-02  3.140537e-02  2.567637e-02  1.490452e-01  6.074293e-02 
          781           782           783           784           785 
 3.341605e-02  4.058362e-02  6.319691e-03  9.565538e-02  2.782712e-02 
          786           787           788           789           790 
 2.162106e-02  7.675156e-02  2.093293e-02  1.993519e-02  3.287576e-02 
          791           792           793           794           795 
 1.619625e-02  3.752509e-02  2.384074e-02  7.000634e-02  1.593303e-02 
          796           797           798           799           800 
 3.010935e-02  3.060837e-02  1.611812e-02  4.582817e-02  1.919815e-01 
          801           802           803           804           805 
 8.762076e-02  1.179540e-01  2.757750e-02  2.829169e-02  2.791627e-02 
          806           807           808           809           810 
 1.233877e-02  2.245367e-02  4.274185e-02  2.288040e-02  1.907217e-02 
          811           812           813           814           815 
 5.371355e-02  5.031766e-02  2.658610e-02  5.472523e-02  2.788894e-02 
          816           817           818           819           820 
 4.401946e-02  2.069074e-02  2.374289e-02  3.680757e-02  3.303674e-02 
          821           822           823           824           825 
 8.843252e-03  3.457333e-02  2.934421e-02  9.607115e-03  5.468375e-02 
          826           827           828           829           830 
 5.146088e-02  2.378054e-02  4.137118e-02  2.393749e-03  6.713702e-02 
          831           832           833           834           835 
 3.454637e-02  1.851526e-02  4.306857e-02  1.943300e-02  1.731163e-01 
          836           837           838           839           840 
 2.290145e-02 -2.641631e-03  3.010718e-02  2.377859e-02  5.396206e-02 
          841           842           843           844           845 
 9.925841e-02  3.055849e-02  1.174481e-02  4.172786e-02  1.881742e-03 
          846           847           848           849           850 
 3.229374e-02  1.193840e-01  3.958850e-03  1.895816e-02 -3.269190e-03 
          851           852           853           854           855 
 2.322800e-02  3.103240e-02  1.060550e-02  5.763710e-02  2.763478e-02 
          856           857           858           859           860 
 2.104703e-02  7.292559e-03  4.354025e-02  2.119603e-02  3.190030e-02 
          861           862           863           864           865 
 8.545861e-02  4.928947e-02  3.218503e-02  2.604151e-02  1.234591e-01 
          866           867           868           869           870 
 3.769384e-02  7.035455e-02  1.128858e-01  2.272844e-03  3.665322e-02 
          871           872           873           874           875 
 1.165138e-02  1.013559e-02  3.746116e-02  7.183476e-03  4.571322e-02 
          876           877           878           879           880 
 2.774088e-02  7.424676e-02  5.487355e-02  1.390685e-02  1.719170e-02 
          881           882           883           884           885 
 1.096724e-01  4.388426e-02  1.277976e-02  7.510820e-02  1.512894e-02 
          886           887           888           889           890 
 2.088910e-02  2.024536e-02  1.001518e-01  4.184813e-02  5.132878e-02 
          891           892           893           894           895 
 2.629845e-02  8.206488e-03  7.411248e-02  6.359383e-03  7.613741e-02 
          896           897           898           899           900 
 1.806349e-01  4.620640e-02  1.181416e-01  1.162016e-02  1.772151e-02 
          901           902           903           904           905 
 1.495727e-02  6.343421e-02  1.876733e-02  2.316604e-02 -4.070042e-03 
          906           907           908           909           910 
 1.454778e-02  4.419290e-02  3.694771e-03  5.613648e-02  3.931151e-02 
          911           912           913           914           915 
 4.238406e-02  1.670250e-02  4.509441e-02  5.061927e-03  4.150265e-03 
          916           917           918           919           920 
 5.794137e-03  8.127423e-02  7.701000e-02  3.954705e-02  6.616370e-02 
          921           922           923           924           925 
 2.569819e-02  2.233553e-02  4.553592e-02  3.292347e-02 -1.495105e-03 
          926           927           928           929           930 
 5.343435e-02  2.673757e-02  1.926673e-02  1.925694e-02  3.269898e-02 
          931           932           933           934           935 
 1.516733e-02  1.576271e-02  7.967936e-03  6.677057e-03  7.291394e-02 
          936           937           938           939           940 
 7.858802e-02  6.635575e-02  6.882058e-03  1.428375e-02 -1.706791e-03 
          941           942           943           944           945 
 2.053338e-02  1.149804e-01  1.298140e-02  2.783896e-02  3.041852e-02 
          946           947           948           949           950 
 2.609952e-02  3.883910e-02  3.400196e-02  7.111391e-03  3.675977e-02 
          951           952           953           954           955 
 1.359490e-02  4.563588e-03  1.363044e-02  1.473574e-02  2.476990e-02 
          956           957           958           959           960 
 2.694476e-01  6.076492e-02  2.722130e-02  1.502662e-02  5.354410e-02 
          961           962           963           964           965 
 2.690526e-02  6.738974e-03  4.014922e-02  5.305628e-02 -1.480073e-03 
          966           967           968           969           970 
 3.572022e-02  1.951792e-02  9.982503e-03  5.111803e-02  1.050831e-02 
          971           972           973           974           975 
 1.373330e-02  4.233430e-03  2.360034e-01  8.365946e-02  3.058717e-02 
          976           977           978           979           980 
 7.172181e-04  1.617426e-02 -2.439168e-03  4.091277e-02  3.419881e-02 
          981           982           983           984           985 
 1.399690e-01  1.062286e-02  1.071532e-02  2.126304e-01  3.627104e-02 
          986           987           988           989           990 
 3.518715e-02  4.846119e-02  2.929961e-02  2.076477e-02  4.001979e-02 
          991           992           993           994           995 
 3.910711e-02 -2.654570e-03  2.165666e-02  1.875746e-02  1.568950e-02 
          996           997           998           999          1000 
 1.595069e-02  2.842432e-02  3.325015e-02  7.024704e-03  2.790617e-02 
 [ reached getOption("max.print") -- omitted 1252 entries ]
```

![](07-tidy-text-and-sentiment-analysis-slides_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---
class: inverse

## Classify


```r
which.max(cor1[-1])
```

```
276 
275 
```

```r
cor_ss = cor(dtm[2252,],t(dtm))[1,]
which.max(cor_ss[-2252])
```

```
Pride &amp; Prejudice 
             2248 
```

---
class: inverse, center, middle

# Sentiment analysis

&lt;font  style='font-size:40pt'&gt;
"I hate this stupid class. But I love the instructor"
&lt;/font&gt;


---
class: inverse, center, middle

# Sentiment analysis

&lt;font  style='font-size:40pt'&gt;
"I &lt;font color="red"&gt;hate&lt;/font&gt; this &lt;font color="red"&gt;stupid&lt;/font&gt; class. But I &lt;font color="blue"&gt;love&lt;/font&gt; the instructor"
&lt;/font&gt;


---
class: inverse, center, middle

# Sentiment analysis

&lt;font  style='font-size:40pt'&gt;
"I &lt;font color="red"&gt;hate&lt;/font&gt; this &lt;font color="red"&gt;stupid&lt;/font&gt; class. But I &lt;font color="blue"&gt;love&lt;/font&gt; the instructor"
&lt;br&gt;
"Oh yeah, I totally &lt;font color="blue"&gt;love&lt;/font&gt; doing DataCamp sessions"
&lt;/font&gt;





---
class: inverse

## Sentiments


```r
library(tidyr)
bing &lt;- sentiments %&gt;%
  filter(lexicon == "bing") %&gt;%
  select(-score)
head(bing)
```

```
# A tibble: 6 x 3
        word sentiment lexicon
       &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;
1    2-faced  negative    bing
2    2-faces  negative    bing
3         a+  positive    bing
4   abnormal  negative    bing
5    abolish  negative    bing
6 abominable  negative    bing
```

---
class: inverse

## Assigning sentiments to words


```r
janeaustensentiment &lt;- tidy_books %&gt;%
  inner_join(bing) %&gt;% 
  count(book, index = linenumber %/% 80, sentiment) %&gt;% 
  spread(sentiment, n, fill = 0) %&gt;% 
  mutate(sentiment = positive - negative)
```

```
Joining, by = "word"
```

```r
head(janeaustensentiment)
```

```
# A tibble: 6 x 5
                 book index negative positive sentiment
               &lt;fctr&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Sense &amp; Sensibility     0       16       26        10
2 Sense &amp; Sensibility     1       19       44        25
3 Sense &amp; Sensibility     2       12       23        11
4 Sense &amp; Sensibility     3       15       22         7
5 Sense &amp; Sensibility     4       16       29        13
6 Sense &amp; Sensibility     5       16       39        23
```

---
class: inverse

## Plotting the sentiment trajectory


```r
suppressPackageStartupMessages({library(ggplot2)})
ggplot(janeaustensentiment, aes(index, sentiment, fill = book)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~book, ncol = 3, scales = "free_x")
```

![](07-tidy-text-and-sentiment-analysis-slides_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---
class: inverse, middle, center

# Tidy text lab

&lt;font color="red"  style='font-size:40pt'&gt;
https://goo.gl/BaiBS1
&lt;/font&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
